# 상품 등록, 조회, 수정, 삭제 기능 구현

## 프로젝트 소개
express.js, MongoDB를 이용하여, 상품 정보를 등록, 조회, 수정, 삭제가 가능한 프로그램을 개발하였다.
|분류|설명|Method|URL|작성|구현|
|---|---|---|---|---|---|
|상품|상품 생성 (C)|POST|/products|O|O|
|상품|상품 목록 조회 (R)|GET|/products|O|O|
|상품|상품 상세 조회 (R)|GET|/products/:id|O|O|
|상품|상품 수정 (U)|PUT|/products/:id|O|O|
|상품|상품 삭제 (D)|DELETE|/products/:id|O|O|

### 1. POST - 상품 등록
상품의 이름, 상세설명, 관리자, 비밀번호를 req로 받아 MongoDB에 저장되도록 한다.

이 때, 상품의 비밀번호는 암호화되어 DB에 저장된다.

이 때 이름, 상세설명, 관리자, 비밀번호 모두 필수 요소이며, 하나라도 전달받지 못할 경우 에러메시지를 반환한다.

또한, 상품의 이름이 겹칠 경우 상품이 저장되지 않고 에러메시지를 반환한다.

등록 시 상품의 상태는 자동으로 'FOR_SALE'로 저장되도록 한다.

상품의 등록일시는 등록하는 시점의 날짜와 시간으로 자동 저장되며, 수정일시는 등록일시와 같은 값을 가진다.

상품의 ID는 따로 입력받지 않고, MongoDB에서 자동으로 생성되는 id를 이용한다.

### 2. GET - 상품 목록 조회
등록된 상품들의 이름, 상세설명, 관리자, 상태, 등록일시, 수정일시를 모두 res로 반환한다.

등록된 상품이 없을 경우 빈 배열을 반환한다.

### 3. GET - 상품 상세 조회
req의 params를 통해 상품의 id를 받으면, id에 해당하는 상품에 대한 정보를 res로 반환한다.

이 때 id에 해당하는 상품이 없으면 에러메시지를 반환한다.

### 4. PUT - 상품 수정
req의 params를 통해 상품의 id를 받고, body를 통해 상품의 수정 내용과 비밀번호를 받아 해당 상품에 대한 내용이 수정된다.

이 때 id에 해당하는 상품이 존재하지 않거나, 비밀번호가 상품의 비밀번호와 일치하지 않을 경우 에러메시지를 반환한다.

또한, 상품의 상태가 'SOLD_OUT' 혹은 'FOR_SALE'이 아닐 경우에도 에러메시지를 반환한다.

### 5. DELETE - 상품 삭제
req의 params를 통해 상품의 id를 받고, body를 통해 비밀번호를 받으면 해당 상품의 데이터가 삭제된다.

이 때 id에 해당하는 상품이 존재하지 않거나, 비밀번호가 상품의 비밀번호와 일치하지 않을 경우 에러메시지를 반환한다.

## 코드 설명
### 1. ./src/crypto
- crypto-passwords.js : crypto 모듈을 이용하여 비밀번호를 암호화한다.
### 2. ./src/middlewares
- error-handler.middleware.js : 상품 입력, 조회, 수정, 삭제 시 발생하는 에러에 대한 에러 핸들러이다.
### 3. ./src/router
- joi-products.js : 상품 등록, 수정, 삭제 시 입력받는 값의 유효성 검증을 위한 joi를 설정하였다.
- router-products.js : /products 경로의 CRUD 라우터를 구현하였다.
### 4. ./src/schemas
- index.js : MongoDB와의 연결을 위한 파일이다.
- schemas-products.js : 데이터 생성 시 사용되는 스키마를 정의하였다.

## 요구사항

### 1. 셋팅
- [x] `README.md` 파일을 생성하여 간략한 프로젝트의 설명 및 실행 방법을 작성합니다.
- [x] `.env` 파일을 이용해서 민감한 정보(DB 계정 정보 등)를 관리합니다.
- [x] `.gitignore` 파일을 생성하여 `.env` ,`node_modules` 등
불필요하거나 민감한 정보가 Github에 올라가지 않도록 설정합니다.
- [x] `.prettierrc` 파일을 생성하여 일정한 코드 형태를 유지할 수 있도록 설정합니다.
- [x] `package.json` 파일의 `scripts` 항목에 `dev` 라는 이름을 추가하여 nodemon을 이용해서 서버를 실행할 수 있도록 합니다.

### 2. 필수 API 구현

#### 1) 상품 생성 API
- [x] 상품명, 상품 설명, 담당자, 비밀번호를 **Request body(`req.body`)** 로 전달 받습니다.
- [x] 상품 ID는 전달 받지 않고, 자동으로 생성합니다. (MongoDB Document 추가 시 기본 생성되는 `_id`를 사용해도 됩니다.)
- [x] 상품은 두 가지 상태, **판매 중(`FOR_SALE`)및 판매 완료(`SOLD_OUT`)** 를 가질 수 있습니다.
- [x] 상품 등록 시 기본 상태는 **판매 중(`FOR_SALE`)** 입니다.
- [x] **생성 일시, 수정 일시**를 자동으로 생성합니다.

#### 2) 상품 목록 조회 API
- [x] **상품 ID, 상품명, 상품 설명, 담당자, 상품 상태, 생성 일시, 수정 일시** 를 조회합니다.
- [x] **비밀번호**를 포함하면 안됩니다.
- [x] 상품 목록은 **생성 일시**를 기준으로 **내림차순(최신순)** 정렬합니다.

#### 3) 상품 상세 조회 API
- [x] **상품 ID**를 **Path Parameter**(`req.params`)로 전달 받습니다.
- [x] **상품 ID, 상품명, 상품 설명, 담당자, 상품 상태, 생성 일시, 수정 일시** 를 조회합니다.
- [x] **비밀번호**를 포함하면 안됩니다.

#### 4) 상품 수정 API
- [x] **상품 ID**를 **Path Parameter**(`req.params`)로 전달 받습니다.
- [x] **상품명, 상품 설명, 담당자, 상품 상태, 비밀번호**를 **Request body**(`req.body`)로 전달 받습니다.
- [x] **수정할 상품과 비밀번호 일치 여부를 확인**한 후, 동일할 때만 상품이 **수정**되어야 합니다. 일치하지 않을 경우, **“비밀번호가 일치하지 않습니다.”** 메세지를 반환합니다.

#### 5) 상품 삭제 API
- [x] **상품 ID**를 **Path Parameter**(`req.params`)로 전달 받습니다.
- [x] **비밀번호**를 **Request body**(`req.body`)로 전달 받습니다.
- [x] **삭제할 상품과 비밀번호 일치 여부를 확인**한 후, 동일할 때만 글이 **삭제**되어야 합니다. 일치하지 않을 경우, **“비밀번호가 일치하지 않습니다.”** 메세지를 반환합니다.

### 3. 유효성 검사 및 에러 처리
#### 1) 에러 처리 (에러 처리 미들웨어)

- [x] **상품 상세 조회, 수정, 삭제 시** **상품이 없는 경우**에는 “**상품이 존재하지 않습니다.**” 메세지를 반환합니다. **상품 목록 조회 시** **상품이 없는 경우**에는 **빈 배열(`[]`)을 반환**합니다.
- [x] **상품 생성 시** 입력 받은 상품명이 **기존에 등록 된 상품명과 동일한 경우**에는 **“이미 등록 된 상품입니다.”** 메세지를 반환합니다.
- [x] **그 밖의 에러가 발생했을 때**에는 **“예상치 못한 에러가 발생했습니다. 관리자에게 문의해 주세요.”** 메세지를 반환합니다.

#### 2) 유효성 검증 (Joi)

- [x] **상품 생성 시 정보가 빠진 경우**, **“OOO을(를) 입력해 주세요.”** 메시지를 반환합니다.
예) ****“상품명을 입력해 주세요”, “담당자를 입력해 주세요.” 등…
- [x] **상품 수정, 삭제 시 비밀번호가 없는 경우**, **“비밀번호를 입력해 주세요.”** 메세지를 반환합니다.
- [x] **상품 수정 시** 상품 상태에 `FOR_SALE`, `SOLD_OUT` 이 외의 다른 값이 입력된 경우, **“상품 상태는 [FOR_SALE,SOLD_OUT] 중 하나여야 합니다.”** 메세지를 반환합니다.

